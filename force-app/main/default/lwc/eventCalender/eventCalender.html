<template>
    <lightning-card>
        <p class="month-title" slot="title">{monthName},{year}</p>
        <div class="slds-m-around_medium" slot="actions">
            <lightning-button-icon icon-name="utility:refresh" onclick={refresh} variant="neutral" class="refresh-btn"></lightning-button-icon>
            <lightning-button-icon icon-name="utility:chevronleft" onclick={handlePrev} variant="brand"></lightning-button-icon>
            <lightning-button-icon icon-name="utility:chevronright" onclick={handleNext} class="slds-m-left_small" variant="brand"></lightning-button-icon>
        </div>

        <!-- Calendar Grid -->
        <div class="slds-grid slds-wrap calendar-grid">
            <template for:each={weekdays} for:item="day">
                <div key={day} class="slds-col slds-size_1-of-7 slds-text-title_bold">{day}</div>
            </template>

            <template for:each={days} for:item="day">
                <div key={day.key} class="slds-col slds-size_1-of-7 calendar-cell">
                    <lightning-card title={day.date}>
                        <!--card body-->
                        <lightning-button-icon if:false={day.isPreviousMonthDate} title="Add Event" slot="actions" icon-name="utility:new" onclick={handleDayClick} data-date={day.date}></lightning-button-icon>
                        <div class="slds-p-horizontal_small">
                            <template for:each={day.initialEvents} for:item="e">
                                <span class="event" key={e.title}><lightning-icon size="x-small" icon-name="standard:event"></lightning-icon>&nbsp;{e.title}</span>
                            </template>
                            <div class="view-all-btn">
                                <template if:true={day.multipleEvents}>
                                    <lightning-button label="View 2+ events" variant="base" data-date={day.date} onclick={showAllEvents}></lightning-button>
                                </template>
                            </div>
                        </div>
                    </lightning-card>
                </div>
            </template>
        </div>
    </lightning-card>

    <!--New Event Modal-->
    <template if:true={newEventModal}>
        <c-modal>
            <lightning-button-icon slot="closeModal" icon-name="utility:close" onclick={closeNewEventModal} variant="border-filled"></lightning-button-icon>
            <div slot="header">New Event</div>
            <div slot="body">
                <lightning-input label="Title" class="evt-form-title"></lightning-input>
                <lightning-input type="datetime" label="Start date" class="evt-form-startdate" value={defultDateTime} ></lightning-input>
                <lightning-input type="datetime" label="End date" class="evt-form-enddate" value={defultDateTime}></lightning-input>
                <div class="evt-form-btn">
                    <lightning-button label="Save" onclick={save} variant="brand"></lightning-button>
                </div>
            </div>
        </c-modal>
    </template>

    <!--Veiw All Event Modal-->
    <template if:true={allEventModal}>
        <c-modal>
            <lightning-button-icon slot="closeModal" icon-name="utility:close" onclick={closeAllEventModal} variant="border-filled"></lightning-button-icon>
            <div slot="header">View All Event</div>
            <div slot="body">
                <table>
                    <tbody>
                    <tr>
                        <th>Title</th>
                        <th>Start</th>
                        <th>End</th>
                        <th>Action</th>
                    </tr>
                    <template for:each={dateEvents} for:item="evt">
                        <tr key={evt.Id}>
                            <td><b>{evt.Name}</b></td>
                            <td><lightning-formatted-date-time value={evt.Event_Start_Date__c} year="numeric"
                                    month="numeric" day="numeric" hour="2-digit" minute="2-digit"
                                    time-zone-name="short"></lightning-formatted-date-time></td>
                            <td><lightning-formatted-date-time value={evt.Event_End_Date__c} year="numeric" month="numeric"
                                    day="numeric" hour="2-digit" minute="2-digit"
                                    time-zone-name="short"></lightning-formatted-date-time></td>
                            <td><lightning-button label="Cancel" variant="destructive-text" disabled={evt.Is_Cancelled__c}></lightning-button></td>
                        </tr>
                    </template>
                    </tbody>
                </table>
            </div>
        </c-modal>
    </template>

    <!--Spinner-->
    <template if:true={loading}>
        <div>
            <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
        </div>
    </template>

</template>
